import React, { useMemo } from 'react';
import { formatRelative, parseISO } from 'date-fns';
import pt from 'date-fns/locale/pt';

import api from '~/services/api';

import Background from '~/components/Background';

import { Container, Avatar, Name, Time, SubmitButton } from './styles';

const Confirm = ({ route, navigation }) => {
  const { provider } = route.params;
  const { time } = route.params;

  const dateFormatted = useMemo(
    () => formatRelative(parseISO(time), new Date(), {locale: pt} ),
    [time]
  );

  async function handleAddAppointment() {
    await api.post('appointments', {
      provider_id: provider.id,
      date: time,
    });

    navigation.navigate('Dashboard');
  }

  return (
    <Background>
      <Container>
        <Avatar
          source={{
            uri: provider.avatar
              ? provider.avatar.url
              : `data:image/jpeg;base64,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`,
          }}
        />

        <Name>{provider.name}</Name>

        <Time>{dateFormatted}</Time>

        <SubmitButton onPress={handleAddAppointment}>
          Confirmar agendamento
        </SubmitButton>
      </Container>
    </Background>
  );
};

export default Confirm;
